<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy 3rd Anniversary, Jaslyn Yeo Hui Wen ðŸ’•</title>
  <meta name="description" content="A little interactive love note." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>ðŸ’–</text></svg>">
  <style>
    :root{
      --bg: #0f1020;
      --fg: #fff;
      --accent: #ff5ea8;
      --accent-2:#9ae6ff;
      --card:#1a1b34;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--fg);
      background:radial-gradient(1200px 800px at 70% -10%, #241a3b, var(--bg));
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
      display:flex; flex-direction:column; align-items:center; gap:18px; padding:16px;
      overflow-x:hidden;
    }
    header{width:100%; max-width:900px; padding:14px 16px; border-radius:14px; background:rgba(26,27,52,.7); backdrop-filter: blur(6px);
      display:flex; align-items:center; justify-content:space-between; gap:12px}
    .title{font-weight:700; letter-spacing:.4px; font-size:1.1rem}
    .tiny{opacity:.85; font-size:.9rem}
    main{width:100%; max-width:900px; display:grid; gap:18px}
    .hero{
      position:relative; overflow:hidden; border-radius:18px; background:linear-gradient(180deg,#20163a, #121325);
      padding:22px; display:grid; grid-template-columns:1.1fr .9fr; gap:18px;
    }
    @media (max-width:800px){ .hero{grid-template-columns:1fr; min-height:auto} }
    .card{ background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:18px; box-shadow: 0 10px 30px rgba(0,0,0,.25) }
    .sparkle{color:var(--accent-2)}

    .slideshow{
      position:relative; width:100%; max-width:820px; height:480px; margin:auto; overflow:hidden;
      border-radius:18px; border:1px solid rgba(255,255,255,.12); background:#0b0f1e;
    }
    .slide{
      position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0; transform:scale(1.05);
      transition: opacity 1.2s ease-in-out, transform 8s linear;
      filter: saturate(1.05) contrast(1.05);
    }
    .slide.active{ opacity:1; transform:scale(1.0); }

    #confetti{
      position:fixed; inset:0; pointer-events:none; z-index:9999;
    }

    .overlay{
      position:fixed; inset:0; z-index:9998; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(1400px 1000px at 70% -10%, #221638, #0f1020);
    }
    .overlay.hidden{ opacity:0; pointer-events:none; transition:opacity .6s ease }
    .envelope{
      width:min(92vw, 560px); height:360px; position:relative;
      perspective:1200px; cursor:pointer; user-select:none;
    }
    .env-card{
      position:absolute; inset:0; border-radius:18px; background:#fff; color:#1a1120;
      display:flex; align-items:flex-start; justify-content:center; flex-direction:column; gap:10px;
      box-shadow: 0 24px 70px rgba(0,0,0,.45);
      padding:120px 20px 20px;
      text-align:center;
      z-index:1;
    }
    .env-card h2{ margin:0 auto; font-size:1.8rem; text-align:center; width:100%; }
    .env-card p{ margin:0 auto; opacity:.8; text-align:center; width:100%; }
    .flap{
      position:absolute; left:0; right:0; top:0; height:50%;
      background:linear-gradient(180deg,#ff9dc6,#ff5ea8);
      clip-path:polygon(0 0, 100% 0, 50% 100%);
      transform-origin:top center;
      transform:rotateX(0deg);
      transition: transform .7s ease;
      z-index:2;
    }
    .envelope.open .flap{ transform:rotateX(-180deg) }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <div class="overlay" id="overlay">
    <div class="envelope" id="envelope">
      <div class="env-card">
        <h2>From your LOYL ðŸ’Œ</h2>
        <p>Tap to open the letter</p>
      </div>
      <div class="flap"></div>
    </div>
  </div>

  <header>
    <div>
      <div class="title">For <span class="sparkle">ðŸ’™ Jaslyn Yeo Hui Wen ðŸ’™</span></div>
      <div class="tiny"><span id="daysTogether">0</span> days and counting Â· 09 September</div>
    </div>
  </header>

  <main>
    <section class="hero card">
      <div>
        <h1 style="margin:0 0 8px">Dear Hui Wen,</h1>
        <p style="margin:0 0 12px; opacity:.95; white-space:pre-line">
Happy 3rd anniversary, my love. Every day with you becomes my new favourite, and even though weâ€™re apart right now, my heart feels closer to you than ever. Thank you for being my home, my laughter, and my best friend. ðŸ’–

This distance is only temporary, just a small chapter in the lifetime weâ€™ll spend together. Iâ€™m so grateful for the ups and downs weâ€™ve gone through, because theyâ€™ve only made us stronger. Soon, weâ€™ll be married and starting our forever as a family and I couldnâ€™t be more excited.

I promise to always love you, to hold your hand through everything, and yes, to accompany you on every shopping trip and food adventure. Youâ€™ll always be my cutie pie, and I love you endlessly.

Always yours,
Yu Cheng
        </p>
      </div>
      <div style="position:relative">
        <div class="slideshow" id="slideshow"></div>
      </div>
    </section>
  </main>

  <footer>Made with love.</footer>

  <audio id="bgMusic" loop playsinline preload="auto">
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <script>
    const startDate = new Date("2022-09-09");
    const daysEl = document.getElementById("daysTogether");
    function updateDays(){
      const now = new Date();
      const diff = Math.floor((now - startDate) / (1000*60*60*24));
      daysEl.textContent = isFinite(diff) ? diff.toLocaleString() : "0";
    }
    updateDays(); setInterval(updateDays, 60_000);

    const bgMusic = document.getElementById("bgMusic");
    async function playMusic(){
      try{
        bgMusic.muted = false;
        bgMusic.volume = 1.0;
        await bgMusic.play();
      }catch(e){/* ignore */}
    }

    let images = [];
    let index = -1;
    let timer = null;
    const duration = 4000;
    const slideshow = document.getElementById("slideshow");

    function createSlide(src){
      const img = document.createElement("img");
      img.className = "slide";
      img.alt = "Our memory together";
      img.decoding = "async";
      img.loading = "lazy";
      img.src = src;
      return img;
    }
    function setActive(i){
      const slides = Array.from(slideshow.querySelectorAll(".slide"));
      slides.forEach(s => s.classList.remove("active"));
      if (slides[i]) slides[i].classList.add("active");
    }
    function nextSlide(){
      if (!images.length) return;
      index = (index + 1) % images.length;
      setActive(index);
    }
    function startSlideshow(){
      if (!images.length) return;
      if (timer) clearInterval(timer);
      slideshow.innerHTML = "";
      images.forEach(img => slideshow.appendChild(createSlide(img.src)));
      nextSlide();
      timer = setInterval(nextSlide, duration);
    }

    // === GitHub Pages friendly loader: use manifest.json ===
    async function loadFromManifest(){
      try{
        const res = await fetch("pictures/manifest.json", {cache:"no-store"});
        if (!res.ok) return false;
        const list = await res.json();
        if (!Array.isArray(list) || !list.length) return false;
        images = list
          .filter(name => typeof name === "string" && /\.(jpe?g|png|gif|webp)$/i.test(name))
          .map(name => ({src: "pictures/" + name}));
        images.sort((a,b) => a.src.localeCompare(b.src, undefined, {numeric:true, sensitivity:"base"}));
        return images.length > 0;
      }catch(e){ return false; }
    }

    // Fallback probe (works if your files follow common names like photo1.jpg or IMG_0001.jpg)
    async function lightProbe(){
      const exts = [".jpg",".jpeg",".JPG",".JPEG",".png",".PNG",".webp",".WEBP"];
      const candidates = [];
      for (let i=1;i<=200;i++){ exts.forEach(ext => candidates.push(`pictures/photo${i}${ext}`)); }
      for (let i=1;i<=200;i++){
        const s4 = String(i).padStart(4,"0");
        ["IMG_","DSC_","PXL_","DXZ_"].forEach(prefix => {
          exts.forEach(ext => candidates.push(`pictures/${prefix}${s4}${ext}`));
        });
      }
      const checks = candidates.map(src => new Promise(resolve => {
        const im = new Image();
        im.onload = () => resolve(src);
        im.onerror = () => resolve(null);
        im.src = src + "?t=" + Date.now();
      }));
      const loaded = await Promise.all(checks);
      const found = loaded.filter(Boolean);
      if (found.length){
        images = found.map(src => ({src}));
        images.sort((a,b) => a.src.localeCompare(b.src, undefined, {numeric:true, sensitivity:"base"}));
        return true;
      }
      return false;
    }

    const overlay = document.getElementById("overlay");
    const envelope = document.getElementById("envelope");

    async function openLetter(){
      envelope.classList.add("open");
      await new Promise(r => setTimeout(r, 650));
      playMusic();
      fireConfetti();
      // Use manifest on GitHub Pages
      const ok = await loadFromManifest();
      if (!ok){ await lightProbe(); }
      startSlideshow();
      overlay.classList.add("hidden");
      setTimeout(() => { overlay.remove(); }, 700);
    }
    envelope.addEventListener("click", openLetter, {once:true});

    function fireConfetti(){
      const canvas = document.getElementById("confetti");
      const ctx = canvas.getContext("2d");
      let W = canvas.width = window.innerWidth;
      let H = canvas.height = window.innerHeight;
      window.addEventListener("resize", () => {
        W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight;
      });
      const N = 200;
      const pieces = Array.from({length:N}).map(()=> ({
        x: Math.random()*W,
        y: -20 - Math.random()*H*0.4,
        r: 4 + Math.random()*6,
        c: `hsl(${Math.floor(Math.random()*360)} 90% 60%)`,
        vx: -1 + Math.random()*2,
        vy: 2 + Math.random()*3,
        a: Math.random()*Math.PI*2,
        va: -0.2 + Math.random()*0.4
      }));
      function tick(t){
        const dt = (t - (tick._last||t))/16.67; tick._last = t;
        ctx.clearRect(0,0,W,H);
        let allOut = true;
        for (const p of pieces){
          p.x += p.vx*dt; p.y += p.vy*dt; p.a += p.va*dt; p.vy += 0.02*dt;
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a);
          ctx.fillStyle = p.c; ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2); ctx.restore();
          if (p.y < H + 30) allOut = false;
        }
        if (!allOut) requestAnimationFrame(tick); else fadeOut();
      }
      function fadeOut(){
        let op = 1;
        const id = setInterval(()=>{
          op -= 0.08; canvas.style.opacity = op.toString();
          if (op <= 0){ clearInterval(id); canvas.remove(); }
        }, 40);
      }
      requestAnimationFrame(tick);
    }
  </script>
</body>
</html>